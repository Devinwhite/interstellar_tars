<!DOCTYPE html>
<html lang="en">

	<head>

		<meta charset="utf-8">
		<title>Tars Control Panel</title>
		<link rel="icon" href="assets/fav.ico">

		<link rel="apple-touch-icon" href="assets/apple-touch-icon.png">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="apple-mobile-web-app-title" content="Tars CTRL" />

		<!-- Bootstrap core CSS -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

		<!-- Custom styles for this template -->
		<link rel="stylesheet" href="css/style.css?v=1.0.0">

	</head>

	<body ontouchstart="">

		<div class="d-flex" id="wrapper">

			<!-- Sidebar -->
			<div id="sidebar-wrapper">
				<nav id="sidebar">
					<div class="sidebar-header">
						<h6>Settings</h6>
					</div>
					<ul class="list-unstyled components">
						<li>
							<a href="#" id="refreshControls">Refresh Controls</a>
						</li>
						<li>
							<a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Advanced</a>
							<ul class="collapse list-unstyled" id="homeSubmenu">
								<li>
									<a href="#" id="getUpdates">Get Updates</a>
								</li>
								<li>
									<a href="#" id="restart">Restart PI</a>
								</li>
							</ul>
						</li>
					</ul>
				</nav>
			</div>
			<!-- /#sidebar-wrapper -->

			<!-- Page Content -->
			<div id="page-content-wrapper">
				<nav class="navbar navbar-light navbar-bg-dark">
					
						<button type="button" id="menu-toggle" class="btn btn-link text-dark">
							<i class="fas fa-align-left"></i>
						</button>
						<h3 class="text-light">TARS CONTROLS</h3>
						<button type="button" id="menu-toggle" class="btn btn-outline-dark invisible">
							<i class="fas fa-align-left"></i>
						</button>
						<!-- <button class="navbar-toggler invisible" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
							<span class="navbar-toggler-icon"></span>
						</button> -->

						<!-- <div class="collapse navbar-collapse" id="navbarSupportedContent">
							<ul class="navbar-nav ml-auto mt-2 mt-lg-0">
								<li class="nav-item active">
								<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
								</li>
								<li class="nav-item">
								<a class="nav-link" href="#">Link</a>
								</li>
								<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									Dropdown
								</a>
								<div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
									<a class="dropdown-item" href="#">Action</a>
									<a class="dropdown-item" href="#">Another action</a>
									<div class="dropdown-divider"></div>
									<a class="dropdown-item" href="#">Something else here</a>
								</div>
								</li>
							</ul>
						</div> -->
					
				</nav>
				
				<!-- container-fluid -->
				<div class="container py-4">
					<div class="btn-group btn-group-toggle w-100" data-toggle="buttons">
						<label class="btn btn-dark btn-lg active" id="clickOff">
							<input type="radio" name="options" id="option1" autocomplete="off" checked> Humor OFF
						</label>
						<label class="btn btn-dark btn-lg" id="clickOn">
							<input type="radio" name="options" id="option2" autocomplete="off"> Humor ON
						</label>
					</div>
					<div class="w-100 controls rounded mt-3 text-center p-2">
						<label class="h5 weight-normal text-light">Sound Board</label>
						<div id="soundBoard" class="d-flex align-content-between flex-wrap">
						</div>
					</div>				
					<div class="dropdown w-100 mt-3">
						<button class="w-100 btn btn-dark btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Play Video
						</button>
						<div id="videoList"  class="dropdown-menu w-100" aria-labelledby="dropdownMenu">						
						</div>
					</div>
					<div id="videoCntrl" style="display:none;" class="controls p-3 rounded-bottom">
						<div class="btn-group w-100" role="group">
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickVideoPause"><i class="fas fa-pause"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickVideoPlay"><i class="fas fa-play"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickVideoStop"><i class="fas fa-stop"></i></button>
						</div>			
					</div>
					<div class="dropdown w-100 mt-3">
						<button class="w-100 btn btn-dark btn-lg dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							Play Music
						</button>
						<div class="dropdown-menu w-100" aria-labelledby="dropdownMenu" id="musicList"></div>
					</div>
					<div id="audioCntrl" style="display:none;" class="controls p-3 rounded-bottom">
						<div class="btn-group w-100" role="group">
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickAudioPause"><i class="fas fa-pause"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickAudioPlay"><i class="fas fa-play"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickAudioPrev"><i class="fas fa-backward"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickAudioNext"><i class="fas fa-forward"></i></button>
							<button type="button" class="btn btn-dark btn-lg mt-3" id="clickAudioStop"><i class="fas fa-stop"></i></button>
						</div>					
					</div>
					<button type="button" class="btn btn-dark btn-lg w-100 mt-3" id="clickReload">Reload Screen</button>
				</div>
			</div>
			<!-- /#page-content-wrapper -->
		</div>
		<!-- /#wrapper -->

		<!-- Bootstrap core JavaScript -->
		<script src="//cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		<script src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" data-auto-replace-svg="nest"></script>

		<script>
			$(function() {
				var conn = new WebSocket('ws://'+location.hostname+':8080');
			
				conn.onopen = function(e) {
					console.log("Connection established!");
				};

				conn.onmessage = function(e) {
					data = {};
					if(isJson(e.data)){
						data = JSON.parse(e.data);
					}
					console.log(e.data);
					if(e.data == "videoDone"){
						$('#clickReload').trigger('click');
					}else if(data.type){						
						//objects go here
					}
				};


				$.get( "loadFiles.php?folder=mp3/music/&filter=*.mp3",{}, function(rd) {
					$('#musicList').empty();
					$('#musicList').append('<button class="dropdown-item btn-lg w-100 text-center clickMusicPlay" type="button">PLAY ALL</button>');
					$.each(rd, function(index) {
						result = rd[index];
						$('#musicList').append('<div class="dropdown-divider"></div>');
						$('#musicList').append('<button class="dropdown-item btn-lg w-100 text-center clickMusicPlay" type="button">'+result.replace(".mp3", "")+'</button>');
					});
				}, "json");
				
				$.get( "loadFiles.php?folder=mp3/&filter=*.mp3",{}, function(rd) {
					$('#soundBoard').empty();
					i=1;
					$.each(rd, function(index) {
						result = rd[index];
						if(i>1){
							$('#soundBoard').append('<div class="dropdown-divider"></div>');
						}
						$('#soundBoard').append('<button type="button" class="btn btn-dark btn-square m-1 clickSoundPlay">'+result.replace(".mp3", "")+'</button>');
						i++;
					});
				}, "json");

				$.get( "loadFiles.php?folder=mp4/&filter=*.mp4",{}, function(rd) {
					$('#videoList').empty();
					i=1;
					$.each(rd, function(index) {
						result = rd[index];
						if(i>1){
							$('#videoList').append('<div class="dropdown-divider"></div>');
						}
						$('#videoList').append('<button class="dropdown-item btn-lg w-100 text-center clickVideoPlay" id="clickVideo" type="button">'+result.replace(".mp4", "")+'</button>');
						i++;
					});
				}, "json");

				$('#clickOn').on('click', function() {
					$.get( "led_on.php",{}, function(rd) {
						//alert("LED TURNED ON");
					}, "json");
				});	
				$('#clickOff').on('click', function() {
					$.get( "led_off.php",{}, function(rd) {
						//alert("LED TURNED OFF");
					}, "json");
				});	
				$('#clickVideoPause').on('click', function() {
					togglePause('#clickVideo', true);
					conn.send('videoPause');
				});
				$('#clickVideoPlay').on('click', function() {
					togglePause('#clickVideo', false);
					conn.send('videoPlay');
				});										
				$('#clickReload, #clickVideoStop').on('click', function() {
					conn.send('reload');
					$('#clickOff').trigger('click');
					$('#audioCntrl').hide();
					$('#videoCntrl').hide();
				});	
				
				$('#videoList').on('click', '.clickVideoPlay', function() {
					togglePause('#clickVideo', false);
					conn.send(JSON.stringify({type:"videoLoad", value:"mp4/"+$(this).text()+".mp4"}));
					$('#videoCntrl').show();				
				});
				$('#musicList').on('click', '.clickMusicPlay', function() {
					togglePause('#clickAudio', false);
					if($(this).text() == "PLAY ALL"){
						conn.send(JSON.stringify({type:"audioLoad", value:$(this).text()}));
						$('#clickAudioPrev').show();
						$('#clickAudioNext').show();
					}else{
						conn.send(JSON.stringify({type:"audioLoad", value:"mp3/music/"+$(this).text()+".mp3"}));
						$('#clickAudioPrev').hide();
						$('#clickAudioNext').hide();
					}					
					$('#audioCntrl').show();
				});				
				$('#soundBoard').on('click', '.clickSoundPlay', function() {
					conn.send(JSON.stringify({type:"audioLoad", value:"mp3/"+$(this).text()+".mp3"}));
				});				
				$('#clickAudioPause').on('click', function() {
					togglePause('#clickAudio', true);
					conn.send('audioPause');
				});
				$('#clickAudioPlay').on('click', function() {
					togglePause('#clickAudio', false);
					conn.send('audioPlay');
				});
				$('#clickAudioStop').on('click', function() {
					conn.send('audioStop');
					$('#audioCntrl').hide();
				});	
				$('#clickAudioPrev').on('click', function() {
					conn.send('audioPrev');
				});	
				$('#clickAudioNext').on('click', function() {
					conn.send('audioNext');
				});	
				$("#menu-toggle").click(function(e) {
					e.preventDefault();
					$("#wrapper").toggleClass("toggled");
				});
				$("#refreshControls").click(function(e) {
					window.location.reload();
				});
				$('#getUpdates').on('click', function() {
					if(confirm("This will updated ALL the TARS screen software. Are you sure you want to update?")){
						$.get( "getUpdates.php",{}, function(rd) {
							conn.send('reload');
							window.location.reload();
						}, "json").fail(function() {
							alert('Something Went Wrong!');
						});
					}
				});	
				$('#restart').on('click', function() {
					if(confirm("You will need to refresh Screen Left after Reboot.  Are you Sure you want to restart?")){
						$.get( "restart.php",{}, function(rd) {
							window.location.reload();
						}, "json").fail(function() {
							alert('Restarting');
						});
					}
				});


				$('#clickAudioPlay').hide();
				$('#clickVideoPlay').hide();				
			});

			function togglePause(type, pause){
				button1 = pause?type+"Pause":type+"Play";
				button2 = pause?type+"Play":type+"Pause";
				$(button1).hide();
				$(button2).show();
				$(button1).removeClass("rounded-left");
				$(button2).addClass("rounded-left");
			}

			function isJson(str) {
				try {
					JSON.parse(str);
				} catch (e) {
					return false;
				}
				return true;
			}

		</script>

	</body>

</html>
